@namespace GadgetsOnlineWebForms.Components.Pages.Views.Store.Details

@page "/Views/Store/Details"
@rendermode InteractiveServer
@using GadgetsOnline.Models
@using GadgetsOnline.Services
@using Microsoft.AspNetCore.Components
@inject NavigationManager NavigationManager
@inject ILogger<Details> Logger

<PageTitle>@pageTitle</PageTitle>

<h2>@Model?.Name</h2>

@if (Model != null)
{
    <p>
        <img alt="@Model.Name" src="@Model.ProductArtUrl" />
    </p>

    <div id="album-details">
        <p>
            <em>Type:</em>
            @Model.Category?.Name
        </p>
        <p>
            <em>Description:</em>
            @Model.Category?.Description
        </p>
        <p>
            <em>Price:</em>$@Model.Price.ToString("F")
        </p>
        <p class="button">
            <NavLink href="@($"/Views/ShoppingCart/ViewCart?addToCart={Model.ProductId}")">Add to cart</NavLink>
        </p>
    </div>
}
else
{
    <p>Loading...</p>
}

@code {
    private Product? Model;
    private string pageTitle = "Gadget";

    [SupplyParameterFromQuery]
    public int? ProductId { get; set; }

    protected override void OnInitialized()
    {
        try
        {
            if (!ProductId.HasValue || ProductId.Value == 0)
            {
                Logger.LogWarning("Invalid or missing productId parameter");
                NavigationManager.NavigateTo("/Views/Home/Index");
                return;
            }

            var inventory = new Inventory();
            Model = inventory.GetProductById(ProductId.Value);

            if (Model == null)
            {
                Logger.LogWarning("Product with ID {ProductId} not found", ProductId.Value);
                NavigationManager.NavigateTo("/Views/Home/Index");
                return;
            }

            pageTitle = "Gadget - " + Model.Name;
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error loading product details for ProductId: {ProductId}", ProductId);
            NavigationManager.NavigateTo("/Views/Home/Index");
        }
    }
}