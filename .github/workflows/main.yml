name: Deploy WebForms to IIS

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: [self-hosted, windows]

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Build and Publish WebForms
      shell: powershell
      run: |
        & "C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\MSBuild\Current\Bin\MSBuild.exe" "GadgetsOnlineWebForms\GadgetsOnlineWebForms.csproj" /p:Configuration=Release /p:RestorePackages=true /p:DeployOnBuild=true /p:WebPublishMethod=FileSystem /p:PublishUrl="C:\inetpub\wwwroot\GadgetsOnlineWebForms" /p:DeleteExistingFiles=false

    - name: Verify deployment
      shell: powershell
      run: |
        Write-Output "ðŸ“‚ Deployed files:"
        Get-ChildItem "C:\inetpub\wwwroot\GadgetsOnlineWebForms"
